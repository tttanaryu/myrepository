# フィックスポイント試験用プログラム　pingcheck 仕様書

フィックスポイントのプログラミング試験で作ったサーバの故障検出プログラムpingcheckの仕様書。
使用言語はJuliaである。

```julia
pingcheck(file_name::String, N=1, m=0, t=Inf) -> nothing
```

## 使用方法
1. Juliaでpingcheck.jlをincludeする。includeの際はpingcheck.jlがあるディレクトリとjuliaを動かすディレクトリに注意すること。
2. includeするとpingcheck.jl内のpingcheckという関数が使えるようになるので、pingcheck(file_name, N, m, t)と入力する。引数のうち、file_nameは必須である。

例
```
julia> include("pingcheck.jl")

julia> pingcheck("pinglog1.txt")
サーバーアドレス：10.20.30.1/16, 故障期間：2021年1月1日0時0分24秒 ～ 2021年1月1日0時1分24秒
サーバーアドレス：192.168.1.1/24, 故障期間：2021年1月1日0時1分34秒 ～ 2021年1月1日0時2分34秒
故障中のサーバー
サーバーアドレス：192.168.1.2/24, 故障期間：2021年1月1日0時2分35秒 ～

julia> pingcheck("pinglog3.txt", 2, 3, 200)
サーバーアドレス：10.20.30.2/16, 故障期間：2020年12月31日23時59分25秒 ～ 2021年1月1日0時2分25秒
故障中のサーバー
サーバーアドレス：192.168.1.2/24, 故障期間：2021年1月1日0時1分35秒 ～
過負荷だったサーバー
サーバーアドレス：10.20.30.1/16, 過負荷期間：2020年12月31日23時58分24秒 ～ 2021年1月1日0時2分24秒
```

## 入力
pingcheckの引数は以下の4つである。

* ファイル名 (file_name)
ping応答確認の結果が記された監視ログファイルのファイル名。ファイル形式はテキストファイルとする。引数として入力する際、ファイル名を""で囲むことに注意。
例：file.txt →　"file.txt"
* N
設問2ではpingのタイムアウトがN回以上連続した場合のみ故障とみなすよう拡張するように指示されている。Nはプログラムのパラメータとして与えられるようにするとのことなので引数に設定。
デフォルト値は1であり、入力の際に省略可。
* m
設問3では直近m回の応答時間がtミリ秒を超えた場合に、サーバが過負荷状態になっているとみなし、各サーバの過負荷状態の期間を出力できるように拡張するように指示されている。mはプログラムのパラメータとして与えられるようにするとのことなので引数に設定。
デフォルト値は0であり、入力の際に省略可。
* t
mと同様にパラメータとして与えられるようにするとのことなので引数に設定。
デフォルト値はInf(無限大)であり、入力の際に省略可。

＊mを省略せずにtを省略した場合、tに0が入力されてしまうため、mを省略せずに入力した場合はtも入力すること。

## 出力
pingcheckの返り値は存在せず、出力形式は文字出力である。
pingcheckの出力は以下の通りである。

* 故障していたサーバ
故障が確認され、修復も確認されたサーバを表示する。以下に例を示す。
```
サーバーアドレス：10.20.30.1/16, 故障期間：2020年12月31日23時58分24秒 ～ 2021年1月1日0時0分24秒
サーバーアドレス：10.20.30.2/16, 故障期間：2020年12月31日23時58分25秒 ～ 2021年1月1日0時2分25秒
```

* 故障していたサブネット
故障が確認され、修復が直ったことも確認されたサブネットを表示する。以下に例を示す。
```
サブネット：10.20.30., 故障期間：2020年12月31日23時59分24秒 ～ 2021年1月1日0時2分24秒
```

* 故障中のサーバ
故障が確認されたが、修復は確認されなかったサーバを表示する。以下に例を示す。
```
故障中のサーバー
サーバーアドレス：192.168.1.1/24, 故障期間：2021年1月1日0時0分34秒 ～
サーバーアドレス：192.168.1.2/24, 故障期間：2020年12月31日23時58分35秒 ～
```

* 故障中のサブネット
故障が確認されたが、修復は確認されなかったサブネットを表示する。以下に例を示す。
```
故障中のサブネット
サブネット：192.168.1., 故障期間：2021年1月1日0時0分34秒 ～
```

* 過負荷だったサーバ
過負荷状態が確認されたサーバを表示する。以下に例を示す。
```
過負荷だったサーバー
サーバーアドレス：10.20.30.1/16, 過負荷期間：2020年12月31日23時58分24秒 ～ 2021年1月1日0時2分24秒
```

## その他
* サブネットの故障判定
今回作成したプログラムでは、同一サブネット内のサーバがすべてN回連続でタイムアウトした後、その内の一部のサーバだけping応答が返ってくるようになった場合、途中までの故障をサブネットの故障として判定することができない(力不足でした)。

例として、同一サブネット内のサーバA、Bがあるとする。また、サブネット内のサーバはAとBだけである。

AとBがともにN回連続でタイムアウトした後、Aのみping応答が返って来た場合、Aが直る直前のAとBがともに故障していた期間を、サブネットの故障として判定できないということである。

また、今回のプログラムではサブネットの故障として判定しても、サーバの故障判定の出力をそのまま行っている(本来なら出力しないようにしたかったですが力不足でした)。

* サーバの過負荷判定
設問3にて、直近m回の平均応答時間がtミリ秒以上の場合をサーバの過負荷状態と判定するように指示されている。
応答のログの中で、タイムアウト等によってあるサーバの応答時間が確認できる回数がm回未満の場合、そのサーバの直近m回の平均応答時間は、応答が確認できたときの応答時間の平均とした(すなわちログ内のそのサーバの平均応答時間である)。
